排队
========================================

第三方微信公众号接入
----------------------------------------

第三方微信公众号(服务号)接入开发接口文档

排队商家列表
^^^^^^^^^^^^^^^^

功能说明:  显示授权的排队商家列表

接口地址:  http://9now.cn/api/web/weixin/near.php

请求方式:  Get

JSONP:    否

输入参数

========== =========== ========= ================================================================================
参数名      类型        是否必须             说明
========== =========== ========= ================================================================================
token        String     【必须】  授权唯一口令由“美味不用等”分配
openid       String     【可选】  接入方的微信openid【注：若需要服务号需支持推送，必须传，否则可空】
mobile       Int        【可选】  用户手机号
latitude     Float      【可选】  用户当前地址位置的纬度
longitude    Float      【可选】  用户当前地址位置的经度
city         String     【可选】  城市名称，填写则只显示该城市的商家
mall         String     【可选】  商场ID，填写则只显示该属于该商场的排队商家。【注：商场ID由” 美味不用等”分配】
main         String     【可选】  总店ID，填写则只显示总店的商家【注：总店ID由” 美味不用等”分配】
style        String     【可选】  控制风格样式
========== =========== ========= ================================================================================

输出
原始网页


我的排队
^^^^^^^^^^^^^^^^

功能说明 显示用户的排队列表

接口地址 http://9now.cn/api/web/weixin/mine.php

请求方式 Get

JSONP   否

输入参数

========== =========== ========= ================================================================================
参数名      类型        是否必须     说明
========== =========== ========= ================================================================================
token      String      【必须】     唯一口令
openid     String      【可选】     接入方的微信openid
mobile     Int         【可选】     用户手机号
latitude   Float       【可选】     用户当前地址位置的纬度
longitude  Float       【可选】     用户当前地址位置的经度
city       String      【可选】     城市名称，填写则只显示该城市的商家
mall       String      【可选】     商场ID，填写则只显示该属于该商场的排队商家。【注：商场ID由” 美味不用等”分配】
main       String      【可选】     总店ID，填写则只显示总店的商家【注：总店ID由” 美味不用等”分配】
========== =========== ========= ================================================================================

输出
原始网页



推送排队状态变更信息
^^^^^^^^^^^^^^^^^^^^^^^^

功能说明  美味不用等提交排队状态变更信息，接入方收到后按照自定义的UI推送给取号用户。

接口地址  由接入方提供

请求方式  Post

JSONP 否

输入参数

========= ======== ========================================================
参数名     类型      说明
========= ======== ========================================================
sfrom      String  来源标识，【注：来源标示由接入方注册给美味不用等授权账号】
mobile     String  手机号
serialid   String  美味不用等流水号
orderid    String  接入方orderid（忽略不入库）
openid     String  来源方微信公共号id，服务号
num        String  号单
qname      String  餐桌类型（如：小桌）
qattr      String  餐桌可容纳人数（如：1-2人）
people     Int     用餐人数
credit     Int     用户当前信誉值
state      Int     排号单状态
wait       Int     前面等待桌数
desc       String  变更提示（如：取号成功）
sign       String  校验签名（需要校验，但忽略不入库）
========= ======== ========================================================

排号单状态::

    1取号中
    2取号成功
    3取号成功（美味不用等历史遗留问题，同2）
    4叫号
    5就餐
    6过号
    7取消
    11取号失败

sign算法如下：::

    所有请求数据均需为 UTF-8 编码，请求 URL 参数名称全部小写。
    STEP1：对 POST 参数按照 KEY 进行排序；
    STEP2：将排序后的 KV 对拼接；
    STEP3：将 secret_key 拼接到最后（secret_key= gepuscene123），
    拼接后格式:
    key1=value1&key2=value2&…….&sk= secret_key；
    STEP4：将所得字符串进行 MD5 运算，返回即为 sign的值。

.. note:: 密钥secret_key由接入方注册给美味不用等授权账号

输出参数::

    errno   Int      错误状态，0：正常；1：出错
    errmsg  String   错误描述，正常则为空
    result  String  成功提示（如：接收成功）

输出示例::

    {
        "err": 0,
        "errMsg": "",
        "result": "接收成功"
    }

提供永久二维码
^^^^^^^^^^^^^^^^^^^^^^^^

使用第三方永久场景二维码

需要对方提供一系列的微信永久二维码，

微信公共号永久二维码生成方法：

参考：http://mp.weixin.qq.com/wiki/18/28fc21e7ed87bec960651f0ce873ef8a.html

我们需要场景值，以及下表格中的url内容，请以文本文件格式提供，格式见范例

==============  =========================================================
参数             说明
==============  =========================================================
ticket          获取的二维码ticket，凭借此ticket可以在有效时间内换取二维码。
expire_seconds  二维码的有效时间，以秒为单位。最大不超过1800。
url             二维码图片解析后的地址，开发者可根据该地址自行生成需要的二维码图片
==============  =========================================================

范例：

====== =================================================
场景值   二维码
====== =================================================
1       http://weixin.qq.com/q/70y82lHkKHtR-q_oYGBP
====== =================================================


第三方微信二维码扫码接口
^^^^^^^^^^^^^^^^^^^^^^^^

接口地址   http://api.9now.cn/api/queue/wx/

请求方式   POST

======= =========== ======== =================================== ================================
参数名   参数含义   是否必须    描述                                 示例
======= =========== ======== =================================== ================================
token   接入方token  是       由美味不用等提供                       WoAiMw
scene   场景值       是       接入方的微信场景二维码对应的场景值       35
openid  微信openid   是       接入方                               oWT18jmTx8qwMcYzs3Z4vtjSc5ca
t       时间戳       是       接入方填写访问时间                     12312452141
sn      校验和       是       安全校验和                            md5(t+appkey)
======= =========== ======== =================================== ================================

响应格式::

    {
        "errno":0,
        "result": {//排号信息
            {
                "name":"美味体验店",
                "openid":" oWT18jmTx8qwMcYzs3Z4vtjSc5ca ",
                "sid":3418,
                "exid":"SH1",
                "serialid ":1232,
                "qname":"小桌",
                "qattr ":"1-2人",
                "type":0,
                "state":2,//取号状态
                "sname":"已取号",
                "num":"A002",
                "people":3,
                "wait":3, //需等待人数
                "waittime":"30分钟"//预计等待时间
                "nowwait":"30分钟"//已等待时间
                "notice":"商家离线，请联系商家", //提示信
            },
       }
    }


======== ====== =============
返回字段  含义   示例
======== ====== =============
errno    int    0成功，非0失败
errmsg   string 系统错误
======== ====== =============

result

======== ========= ========================= ==================================================
返回字段  字段类型    含义                       示例
======== ========= ========================= ==================================================
sid      int       美味不用等商家id             3418
exid     String    第三方商家id                SH1
name     string    美味不用等商家名称           美味体验店
state    int       排号单状态                  1、取号中；2、3已取号；4、叫号中；5、已就餐；6、已过号
sname    String    取号状态名称
qname    string    小桌
qattr    string    1-2人
type     int       队列类型
people   int       取号人数
num      String    排队号码
wait     int       等待人数
waittime string    预计等待时间
nowwait  String    已等待时间
notice   String    提醒消息：例如过号作废等
======== ========= ========================= ==================================================




